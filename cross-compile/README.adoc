# Setting up Cross Compilation

The following steps and scripts are adapted from the excellent guides by https://mechatronicsblog.com/cross-compile-and-deploy-qt-5-12-for-raspberry-pi/[mechatronicsblog] and the https://wiki.qt.io/RaspberryPi2EGLFS[QT Wiki], with some modification for the University of Calgary Solar Car team's use case.

These scripts were tested on the Feburary 13, 2020 version of Raspbian
```
PRETTY_NAME="Raspbian GNU/Linux 10 (buster)"
NAME="Raspbian GNU/Linux"
VERSION_ID="10"
VERSION="10 (buster)"
VERSION_CODENAME=buster
ID=raspbian
ID_LIKE=debian
HOME_URL="http://www.raspbian.org/"
SUPPORT_URL="http://www.raspbian.org/RaspbianForums"
BUG_REPORT_URL="http://www.raspbian.org/RaspbianBugs"

```

As well as on Elementary OS 5.0 Juno (Built on Ubuntu 18.04.2 LTS)

There are two scripts, one to configure an appropriate environment for the Raspberry Pi, and another to configure the cross compilation environment for your desktop machine.

The Pi script is intended to be used to set it up from scratch, if you are working with an exising working image, skip to "Setting up the Cross-Compilation on your Desktop".

## Setting Up the Pi

. https://projects.raspberrypi.org/en/projects/raspberry-pi-setting-up[Setup Raspbian on the Pi], and make sure it has a good internet connection
. Update the Pi to the latest firmware & reboot
+
```
sudo rpi-update
sudo reboot
```

. Use `sudo raspi-config` to open the configuration, and enable ssh:
+
```
Interfacing Options -> SSH -> Yes
```

. Edit `/etc/apt/sources.list` to uncomment the `deb-src` line.
This will give the Pi access to system repositories.

. Clone this repository, and run the `SetupRaspi.sh` script.

## Setting up the Cross-Compilation on your Desktop

You will need a good internet connection, and the Pi will need to be powered on and connected to the same network as your computer.

. Set up an ssh-key for the Pi
.. On your computer, get your SSH key, or generate one if it doesn't exist
+
```
ssh-keygen -f ~/.ssh/id_rsa -q -P ""
cat ~/.ssh/id_rsa.pub
```
Copy the output of the `cat` command to your clipboard.
This is your public ssh-key.

.. `ssh` to the pi, and create an `authorized_keys` file
+
```
mkdir ~/.ssh
chmod 0700 ~/.ssh
touch ~/.ssh/authorized_keys
chmod 0644 ~/.ssh/authorized_keys
```
In that file, paste your ssh-key in.
You should now be able to `ssh` into the pi without getting a prompt for a password.

. Make sure you have gcc & g++ installed.
If you don't, install with:
+
```
sudo apt install build-essential
```

. From here, run the `SetupCompileEnv.sh` script on your desktop.
Setup will take about *_four hours_*, so please make sure you consistent connection to the internet & to the Pi during that time.
* By default, the script will look for the pi at `pi@raspberrypi.local`. See the `-h` help prompt for info on how to modify this.

. If the script was successful, a `qmake` will be found in `~/raspi/qt5/bin/`, and will allow you to build your QT projects for the raspberry pi.
* Projects generated by that `qmake` command will use the compiling binaries (`gcc`, `g++`, etc) found in `~/raspi/tools/arm-bcm2708/gcc-linaro-arm-linux-gnueabihf-raspbian-x64/bin/`
